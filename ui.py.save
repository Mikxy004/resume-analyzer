# ui.py â€“ Tkinter Desktop App
last_result = None
import threading
import time
import tkinter as tk
from tkinter import ttk
from tkinter import filedialog, messagebox
from tkinter.scrolledtext import ScrolledText
import time
from main import analyze_resume

#Call the function with your resume file
resume_data = analyze_resume("resume.pdf")
resume_data = analyze_resume("resume.docx")

# Print the result
print("Structure Hits:", resume_data["structure_hits"])
print("Skills Found:", resume_data["skills"])

def show_splash():
    splash = tk.Toplevel()
    splash.overrideredirect(True)
    splash.configure(bg="white")

    width, height = 420, 220
    screen_w = splash.winfo_screenwidth()
    screen_h = splash.winfo_screenheight()
    x = (screen_w - width) // 2
    y = (screen_h - height) // 2
    splash.geometry(f"{width}x{height}+{x}+{y}")

    title = tk.Label(
        splash,
        text="AI Resume Analyzer",
        font=("Segoe UI", 20, "bold"),
        bg="white"
    )
    title.pack(pady=50)

    subtitle = tk.Label(
        splash,
        text="initializing AI modules...",
        font=("Segoe UI", 11),
        fg="gray",
        bg="white"
    )
    subtitle.pack()

    splash.update()
    time.sleep(2)
    splash.destroy()


def upload_and_analyze():
    global last_result

    file_path = filedialog.askopenfilename(
        title="Select Resume",
        filetypes=[("Resume Files", "*.pdf *.docx")]
    )

    if not file_path:
        return

    status_label.config(text="ðŸ¤– Thinking...")
    root.update()

    try:
        result = analyze_resume(file_path)
        last_result = result

        score = result.get("score", 0)
        score_label.config(text=f"Resume Score: {score}/100")
        score_bar["value"] = score

        status_label.config(text="âœ” Analysis Complete")

        result_box.delete("1.0", tk.END)
        result_box.insert(tk.END, "=== AI Resume Analysis ===\n\n")
        result_box.insert(tk.END, f"Skills Found: {', '.join(result['skills_found'])}\n")
        result_box.insert(tk.END, f"Resume Length: {result['text_length']} characters\n\n")
        result_box.insert(tk.END, "Preview:\n")
        result_box.insert(tk.END, result['text_preview'])

    except Exception as e:
        messagebox.showerror("Error", str(e))
        status_label.config(text="Error")

    finally:
        upload_button.config(state="normal")

def show_full_resume():
    if not last_result or "full_text" not in last_result:
        messagebox.showinfo("Info", "No resume loaded yet.")
        return

    result_box.delete("1.0", tk.END)
    result_box.insert(tk.END, "=== FULL RESUME TEXT ===\n\n")
    result_box.insert(tk.END, last_result["full_text"])

def animate_thinking():
    for _ in range(6):
        for dots in ["", ".", "..", "..."]:
            status_label.config(text=f"ðŸ¤– Thinking{dots}")
            time.sleep(3)


# --- UI Layout ---

root = tk.Tk()
root.withdraw()
show_splash()
root.deiconify()
root.iconphoto(False, tk.PhotoImage(file="assets/ar-nalyzer.png"))
root.title("AI-Powered Resume Analyzer")
root.geometry("780x620")
root.configure(bg="#f7f9fc")

header = tk.Label(
    root,
    text="AI Resume Analyzer",
    font=("Segoe UI", 22, "bold"),
    bg="#f7f9fc"
)
header.pack(pady=15)

upload_button = tk.Button(
   root,
   text="Upload Resume",
   font=("Segoe UI", 11, "bold"),
   bg="#4f46e5",
   fg="white",
   padx=20,
   pady=8,
   relief="flat",
   cursor="hand2",
   command=upload_and_analyze
)
upload_button.pack(pady=5)

score_label = tk.Label(
   root,
   text="Resume Score: --",
   font=("Segoe UI", 11, "bold"),
   bg="#f7f9fc"
)
score_label.pack(pady=5)

score_bar = ttk.Progressbar(
    root,
    orient="horizontal",
    length=400,
    mode="determinate"
)
score_bar.pack(pady=5)

status_label = tk.Label(
    root,
    text="Waiting for resume...",
    font=("Segoe UI", 10),
    fg="gray",
    bg="#f7f9fc"
)
status_label.pack(pady=5)

result_box = ScrolledText(
    root,
    width=90,
    height=20,
    font=("Consolas", 10),
    bg="white",
    relief="flat"
)
result_box.pack(padx=20, pady=15)

show_button = tk.Button(
    root,
    text="Show Full Resume",
    command=show_full_resume
)
show_button.pack(pady=10)

root.mainloop()
